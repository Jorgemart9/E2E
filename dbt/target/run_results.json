{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.15", "generated_at": "2025-12-09T18:25:40.930040Z", "invocation_id": "5f3ed03f-0d1a-42a5-bd81-91192a86e199", "invocation_started_at": "2025-12-09T18:25:38.377576Z", "env": {}}, "results": [{"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-09T18:25:40.396728Z", "completed_at": "2025-12-09T18:25:40.439878Z"}, {"name": "execute", "started_at": "2025-12-09T18:25:40.442477Z", "completed_at": "2025-12-09T18:25:40.496819Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.11264681816101074, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.nyc_911_analytics.source_not_null_raw_nyc_data_emergency_calls_cad_evnt_id.619d825ecb", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect cad_evnt_id\nfrom \"new_york\".\"public\".\"emergency_calls\"\nwhere cad_evnt_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-09T18:25:40.408024Z", "completed_at": "2025-12-09T18:25:40.441947Z"}, {"name": "execute", "started_at": "2025-12-09T18:25:40.455719Z", "completed_at": "2025-12-09T18:25:40.506867Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.11752700805664062, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.nyc_911_analytics.source_unique_raw_nyc_data_emergency_calls_cad_evnt_id.d65757aa3b", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    cad_evnt_id as unique_field,\n    count(*) as n_records\n\nfrom \"new_york\".\"public\".\"emergency_calls\"\nwhere cad_evnt_id is not null\ngroup by cad_evnt_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T18:25:40.396036Z", "completed_at": "2025-12-09T18:25:40.396042Z"}, {"name": "execute", "started_at": "2025-12-09T18:25:40.413611Z", "completed_at": "2025-12-09T18:25:40.535239Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.14483284950256348, "adapter_response": {"_message": "INSERT 5", "code": "INSERT", "rows_affected": 5}, "message": "INSERT 5", "failures": null, "unique_id": "seed.nyc_911_analytics.borough_centroids", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T18:25:40.531290Z", "completed_at": "2025-12-09T18:25:40.543022Z"}, {"name": "execute", "started_at": "2025-12-09T18:25:40.543975Z", "completed_at": "2025-12-09T18:25:40.624665Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.09868359565734863, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.nyc_911_analytics.stg_nyc_911_calls", "compiled": true, "compiled_code": "with source as (\n\n    select * from \"new_york\".\"public\".\"emergency_calls\"\n\n),\n\nrenamed as (\n\n    select\n        -- IDs y Claves\n        cad_evnt_id as event_id,\n        \n        -- Fechas y Tiempos\n        create_date as created_at,\n        incident_date,\n        incident_time, -- Podr\u00edas intentar combinarlos si incident_date no tiene hora\n        add_ts as added_at,\n        disp_ts as dispatched_at,\n        arrivd_ts as arrived_at,\n        closng_ts as closed_at,\n\n        -- Detalles del Incidente\n        typ_desc as incident_type_description,\n        radio_code,\n        cip_jobs as job_status, -- Critical Injury / Police jobs\n        \n        -- Ubicaci\u00f3n\n        boro_nm as borough,\n        patrl_boro_nm as patrol_borough,\n        nypd_pct_cd as precinct_id,\n        latitude,\n        longitude,\n        geo_cd_x,\n        geo_cd_y\n\n    from source\n\n)\n\nselect * from renamed", "relation_name": "\"new_york\".\"public_staging\".\"stg_nyc_911_calls\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T18:25:40.635096Z", "completed_at": "2025-12-09T18:25:40.643662Z"}, {"name": "execute", "started_at": "2025-12-09T18:25:40.644472Z", "completed_at": "2025-12-09T18:25:40.704778Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.07228899002075195, "adapter_response": {"_message": "SELECT 0", "code": "SELECT", "rows_affected": 0}, "message": "SELECT 0", "failures": null, "unique_id": "model.nyc_911_analytics.fct_incidents", "compiled": true, "compiled_code": "with staging as (\n    \n    select * from \"new_york\".\"public_staging\".\"stg_nyc_911_calls\"\n),\n\ncentroids as (\n\n    select * from \"new_york\".\"public\".\"borough_centroids\"\n\n),\n\n-- 1. Separamos los datos que YA tienen barrio\ndata_with_borough as (\n    \n    select * from staging \n    where borough is not null\n\n),\n\n-- 2. Separamos los datos que NO tienen barrio (NULL)\ndata_missing_borough as (\n    \n    select * from staging \n    where borough is null \n      and latitude is not null -- Solo podemos arreglar si tenemos coordenadas\n\n),\n\n-- 3. Magia: Cruzamos los nulos con los 5 centroides y calculamos la distancia\ncalculated_boroughs as (\n    \n    select \n        incident.event_id,\n        centroid.borough_name as imputed_borough,\n        -- F\u00f3rmula de distancia simple (Pitagoras) para encontrar el m\u00e1s cercano\n        (power(incident.latitude - centroid.centroid_lat, 2) + \n         power(incident.longitude - centroid.centroid_lon, 2)) as distance_squared\n    from data_missing_borough incident\n    cross join centroids centroid\n\n),\n\n-- 4. Nos quedamos solo con el barrio m\u00e1s cercano para cada incidente\nclosest_match as (\n    \n    select distinct on (event_id)\n        event_id,\n        imputed_borough\n    from calculated_boroughs\n    order by event_id, distance_squared asc\n\n),\n\n-- 5. Unimos todo de nuevo\nfinal_combined as (\n\n    -- Filas originales que estaban bien\n    select \n        event_id,\n        incident_type_description,\n        borough,\n        dispatched_at, -- Necesarios para c\u00e1lculo, luego los quitamos\n        arrived_at,\n        created_at,\n        closed_at,\n        latitude,\n        longitude\n    from data_with_borough\n\n    union all\n\n    -- Filas reparadas (unimos la data original con el barrio calculado)\n    select \n        m.event_id,\n        m.incident_type_description,\n        c.imputed_borough as borough, -- Aqu\u00ed usamos el barrio calculado\n        m.dispatched_at,\n        m.arrived_at,\n        m.created_at,\n        m.closed_at,\n        m.latitude,\n        m.longitude\n    from data_missing_borough m\n    join closest_match c on m.event_id = c.event_id\n\n),\n\nmetrics as (\n\n    select\n        event_id,\n        incident_type_description,\n        borough,\n        \n        -- C\u00e1lculos (usamos las fechas aqu\u00ed antes de descartarlas)\n        extract(epoch from (arrived_at - dispatched_at)) / 60 as response_time_minutes,\n        extract(epoch from (closed_at - created_at)) / 60 as total_duration_minutes,\n\n        latitude,\n        longitude\n\n    from final_combined\n    -- Filtros de limpieza\n    where dispatched_at is not null \n      and arrived_at is not null\n\n)\n\n-- Selecci\u00f3n final: Aqu\u00ed EXCLUIMOS precinct_id, created_at y arrived_at como pediste\nselect \n    event_id,\n    incident_type_description,\n    borough,\n    response_time_minutes,\n    total_duration_minutes,\n    latitude,\n    longitude\nfrom metrics", "relation_name": "\"new_york\".\"public_public\".\"fct_incidents\"", "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-09T18:25:40.727268Z", "completed_at": "2025-12-09T18:25:40.749195Z"}, {"name": "execute", "started_at": "2025-12-09T18:25:40.752317Z", "completed_at": "2025-12-09T18:25:40.815556Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.11044049263000488, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.nyc_911_analytics.not_null_fct_incidents_borough.8a60256450", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect borough\nfrom \"new_york\".\"public_public\".\"fct_incidents\"\nwhere borough is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-09T18:25:40.734970Z", "completed_at": "2025-12-09T18:25:40.749863Z"}, {"name": "execute", "started_at": "2025-12-09T18:25:40.758438Z", "completed_at": "2025-12-09T18:25:40.819532Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.11275100708007812, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.nyc_911_analytics.accepted_values_fct_incidents_borough__MANHATTAN__BRONX__BROOKLYN__QUEENS__STATEN_ISLAND.b59407d346", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        borough as value_field,\n        count(*) as n_records\n\n    from \"new_york\".\"public_public\".\"fct_incidents\"\n    group by borough\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'MANHATTAN','BRONX','BROOKLYN','QUEENS','STATEN ISLAND'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-09T18:25:40.739992Z", "completed_at": "2025-12-09T18:25:40.760516Z"}, {"name": "execute", "started_at": "2025-12-09T18:25:40.766996Z", "completed_at": "2025-12-09T18:25:40.826669Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.1144554615020752, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.nyc_911_analytics.not_null_fct_incidents_response_time_minutes.7c4674f6d6", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect response_time_minutes\nfrom \"new_york\".\"public_public\".\"fct_incidents\"\nwhere response_time_minutes is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-09T18:25:40.744927Z", "completed_at": "2025-12-09T18:25:40.765113Z"}, {"name": "execute", "started_at": "2025-12-09T18:25:40.772172Z", "completed_at": "2025-12-09T18:25:40.832953Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.11730694770812988, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.nyc_911_analytics.not_null_fct_incidents_event_id.88b71a051e", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect event_id\nfrom \"new_york\".\"public_public\".\"fct_incidents\"\nwhere event_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2025-12-09T18:25:40.848512Z", "completed_at": "2025-12-09T18:25:40.866596Z"}, {"name": "execute", "started_at": "2025-12-09T18:25:40.868051Z", "completed_at": "2025-12-09T18:25:40.901315Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.06048440933227539, "adapter_response": {"_message": "SELECT 1", "code": "SELECT", "rows_affected": 1}, "message": null, "failures": 0, "unique_id": "test.nyc_911_analytics.unique_fct_incidents_event_id.fcac0092af", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    event_id as unique_field,\n    count(*) as n_records\n\nfrom \"new_york\".\"public_public\".\"fct_incidents\"\nwhere event_id is not null\ngroup by event_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}], "elapsed_time": 0.7213442325592041, "args": {"require_nested_cumulative_type_params": false, "log_file_max_bytes": 10485760, "require_batched_execution_for_custom_microbatch_strategy": false, "state_modified_compare_more_unrendered_values": false, "require_all_warnings_handled_by_warn_error": false, "source_freshness_run_project_hooks": true, "introspect": true, "project_dir": "/usr/app/dbt", "print": true, "log_format_file": "debug", "resource_types": [], "exclude_resource_types": [], "log_level_file": "debug", "log_path": "/usr/app/dbt/logs", "cache_selected_only": false, "defer": false, "select": ["+fct_incidents"], "use_colors_file": true, "log_format": "default", "warn_error_options": {"error": [], "warn": [], "silence": []}, "quiet": false, "profiles_dir": "/usr/app/dbt", "require_yaml_configuration_for_mf_time_spines": false, "indirect_selection": "eager", "require_explicit_package_overrides_for_builtin_materializations": true, "require_resource_names_without_spaces": true, "validate_macro_args": false, "partial_parse_file_diff": true, "favor_state": false, "macro_debugging": false, "vars": {}, "require_generic_test_arguments_property": true, "send_anonymous_usage_stats": true, "include_saved_query": false, "static_parser": true, "skip_nodes_if_on_run_start_fails": false, "use_colors": true, "partial_parse": true, "invocation_command": "dbt build --select +fct_incidents", "version_check": true, "show_all_deprecations": false, "show": false, "use_fast_test_edges": false, "strict_mode": false, "state_modified_compare_vars": false, "upload_to_artifacts_ingest_api": false, "which": "build", "write_json": true, "show_resource_report": false, "exclude": [], "export_saved_queries": false, "log_level": "info", "populate_cache": true, "empty": false, "printer_width": 80}}